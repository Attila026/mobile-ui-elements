<!--
  force-selector-list element is an extension of polymer-selector element and provides a wrapper around force-data-collection element. The element acts as a base for any list UI element that also needs the selector functionality.

  @extends polymer-selector

  @attributes:
  sobject: (Required) Type of sobject on which you want to render a list
  query: (Optional) SOQL/SOSL/SmartSQL statement to fetch the records. Required when querytype is soql, sosl or cache.
  querytype: Type of query (mru, soql, sosl, cache). Required if query is specified.
  And all the attributes of the polymer-selector element.

  @properties:
  get collection: Returns an instance of Force.SObjectCollection with associated models
-->
<link rel="import" href="../force-sobject-collection/force-sobject-collection.html">
<link rel="import" href="../../dependencies/polymer-elements/polymer-selector/polymer-selector.html">
<polymer-element name="force-selector-list" attributes="sobject query querytype" extends="polymer-selector">
  <template>
    <force-sobject-collection id="listsource" sobject="{{sobject}}" querytype="{{querytype}}" query="{{query}}" autosync="false"></force-sobject-collection>
    <content id="content" select="template"></content>
    <shadow></shadow>
  </template>
  <script>
    Polymer('force-selector-list', {
        observe: {
          sobject: "fetch",
          query: "fetch",
          querytype: "fetch"
        },
        get collection() {
          return this.$.listsource.collection;
        },
        fetch: function() {
          this.$.listsource.fetch();
        },
        renderTemplates: function() {
          var that = this;

          that.$.content.getDistributedNodes()
          .forEach(function(node) {
              var model = node.model || node.templateInstance.model || {};
              model = _.extend({}, model, that);
              node.model = model;
          });
        },
        ready: function() {
            this.super();
            this.fetch();

            $(document).one('WebComponentsReady', this.renderTemplates.bind(this));
        }
    });
  </script>
</polymer-element>