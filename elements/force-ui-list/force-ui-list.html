<!--
    force-ui-list element enables the rendering of simple list of salesforce records driven by a force-sobject-collection. It extends the force-selector-list element to allow all the fetching of records and to detect record selection based on user's tap actions.
    Why: a) Renders the list of records within a Force.SObjectCollection as an Unordered List.

    @extends force-selector-list

    @attributes:
    labelfield: (Optional) Default: Name. Name of the field to be used as label on each list element.
    sublabelfield: (Optional) Name of the field to be used as the sublabel on each list element.

    @properties:
    selected: Returns the value of "idfield" of the selected records.
-->
<link rel="import" href="../../dependencies/polymer/polymer.html">
<link rel="import" href="../force-sobject-collection/force-sobject-collection.html">
<link rel="import" href="../../dependencies/iron-selector/iron-selector.html">
<dom-module id="force-ui-list">
  <template>
      <force-sobject-collection id="listsource" sobject="[[sobject]]" querytype="[[querytype]]" query="[[query]]" autosync="false"></force-sobject-collection>
      <div class="table-view">
        <iron-selector id="selector" attr-for-selected="id" on-iron-select="_updateSelected">
        <template is="dom-repeat" items="[[viewModels]]">
          <div id="[[item.id]]" class="table-view-cell">
            <span>[[item.label]]</span>
            <p>[[item.sublabel]]</p>
          </div>
        </template>
        </iron-selector>
      </div>
  </template>
  <script>
    Polymer({
      is: 'force-ui-list', 

      properties: {
        sobject: String,
        query: {
          type: String,
          value: null
        },
        querytype: {
          type: String,
          value: "mru"
        },
        labelfield: {
          type: String,
          value: 'Name'
        },
        sublabelfield: String,
        selected: {
          type: String,
          readOnly: true,
          notify: true
        }
      },

      listeners: {
        "sync": "updateModels"
      },

      _updateSelected: function() {
        this._setSelected(this.$.selector.selected);
      },

      updateModels: function() {
        var that = this;
        var viewModels = []
        this.$.listsource.collection.models.forEach(function(model) {
          var wrappedModel = {
            id: model.id,
            label: model.attributes[that.labelfield],
            sublabel: model.attributes[that.sublabelfield]
          }
          viewModels.push(wrappedModel);
        });
        this.viewModels = viewModels;
      }
    });
  </script>
</dom-module>